#!/usr/bin/env bash

# This is the project root.
declare DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
# Add npm bin to PATH
PATH="$DIR/node_modules/.bin:$PATH"

# Log a message.
function log {
    echo -e " \033[32m*\033[0m ${1}"
}
# write an error message.
function error {
    echo -e "\033[31m${1}\033[0m"
}


#
# Utilities to check core dependencies
#
function check_npm_installed {
    if [ -z "$(which npm)" ] ;
    then
        error "Node and npm are required"
        exit 1;
    fi
}

function check_deps {
    check_npm_installed
}

#
# utilities to install packages.
#

function install_npm {
    if [ -z "$(which ember)" ] ;
    then
        log "Install ember cli"
        npm install ember-cli
    fi
    log "Install npm dependencies"
    npm install
}

function install_bower {
    if [ -z "$(which bower)" ] ;
    then
        log "Install bower"
        npm install bower
    fi
    log "Install bower dependencies"
    bower install
}

function install {
    check_deps
    install_npm
    install_bower
}

install

if [ $? -eq 0 ] ; then
    log "Everything went fine."
else
    error "An error append, please check command output for more information."
fi
